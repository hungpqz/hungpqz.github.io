var __reflect=this&&this.__reflect||function(t,e,r){t.__class__=e,r?r.push(e):r=[e],t.__types__=t.__types__?r.concat(t.__types__):r},__extends=this&&this.__extends||function(t,e){function r(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);r.prototype=e.prototype,t.prototype=new r},__awaiter=this&&this.__awaiter||function(t,e,r,i){return new(r||(r=Promise))(function(n,a){function s(t){try{h(i.next(t))}catch(e){a(e)}}function o(t){try{h(i["throw"](t))}catch(e){a(e)}}function h(t){t.done?n(t.value):new r(function(e){e(t.value)}).then(s,o)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function r(t){return function(e){return i([t,e])}}function i(r){if(n)throw new TypeError("Generator is already executing.");for(;h;)try{if(n=1,a&&(s=a[2&r[0]?"return":r[0]?"throw":"next"])&&!(s=s.call(a,r[1])).done)return s;switch(a=0,s&&(r=[0,s.value]),r[0]){case 0:case 1:s=r;break;case 4:return h.label++,{value:r[1],done:!1};case 5:h.label++,a=r[1],r=[0];continue;case 7:r=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===r[0]||2===r[0])){h=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){h.label=r[1];break}if(6===r[0]&&h.label<s[1]){h.label=s[1],s=r;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(r);break}s[2]&&h.ops.pop(),h.trys.pop();continue}r=e.call(t,h)}catch(i){r=[6,i],a=0}finally{n=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}var n,a,s,o,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:r(0),"throw":r(1),"return":r(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.prize=new Array,e.redrawNumber=20,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return r.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return r.sent(),this.stage.removeChild(t),[3,4];case 3:return e=r.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){var t=this.createBitmapByName("bg_jpg");this.addChild(t);var e=this.stage.stageWidth,r=this.stage.stageHeight;console.log(this.stage.stageWidth),t.width=e,t.height=r,this.wSocket=new WebSocketControl,this.wSocket.x=e/2-100,this.wSocket.y=100,this.addChild(this.wSocket),this.wSocket.addEventListener("getMaxPeople",this.waitScene,this)},e.prototype.shuffle=function(t){var e,r,i=t.length;if(i)for(;--i;)r=Math.floor(Math.random()*(i+1)),e=t[r],t[r]=t[i],t[i]=e;return t},e.prototype.buildNumber=function(t){return 10>t?"00"+t:100>t?"0"+t:""+t},e.prototype.runNumber=function(t){var e=this;this.stopNumber=t,console.log(this.stopNumber[0]+"-"+this.stopNumber[1]+"-"+this.stopNumber[2]);var r=new egret.Timer(50,50);r.addEventListener(egret.TimerEvent.TIMER,function(){e.drawNumber_1.text=""+Math.floor(9*Math.random()),e.drawNumber_2.text=""+Math.floor(9*Math.random()),e.drawNumber_3.text=""+Math.floor(9*Math.random())},this),r.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){e.drawNumber_1.text=e.stopNumber[0],e.drawNumber_2.text=""+Math.floor(9*Math.random()),e.drawNumber_3.text=""+Math.floor(9*Math.random());var t=new egret.Timer(100,20);t.addEventListener(egret.TimerEvent.TIMER,function(){e.drawNumber_2.text=""+Math.floor(9*Math.random()),e.drawNumber_3.text=""+Math.floor(9*Math.random())},e),t.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){e.drawNumber_2.text=e.stopNumber[1],e.drawNumber_3.text=""+Math.floor(9*Math.random());var t=new egret.Timer(150,10);t.addEventListener(egret.TimerEvent.TIMER,function(){e.drawNumber_3.text=""+Math.floor(9*Math.random())},e),t.addEventListener(egret.TimerEvent.TIMER_COMPLETE,function(){e.drawNumber_3.text=e.stopNumber[2]},e),t.start()},e),t.start()},this),r.start()},e.prototype.waitScene=function(t){var e=this.createBitmapByName("title_jpg");this.addChild(e);for(var r=0;r<t.data;++r)this.prize[r]=r+1;this.prize=this.shuffle(this.prize),console.log("Prize array: "+this.prize),this.wSocket.addEventListener("drawPrize",this.DrawScene,this),this.wSocket.addEventListener("randomNow",this.randomNumber,this),this.wSocket.addEventListener("startDraw",this.StartDraw,this)},e.prototype.randomNumber=function(){var t=this;this.randomTime=new egret.Timer(50,0),this.randomTime.addEventListener(egret.TimerEvent.TIMER,function(){t.drawNumber_1.text=""+Math.floor(9*Math.random()),t.drawNumber_2.text=""+Math.floor(9*Math.random()),t.drawNumber_3.text=""+Math.floor(9*Math.random())},this),this.randomTime.start(),this.removeChild(this.start_btn),this.stop_btn=this.createBitmapByName("stop_btn_png"),this.stop_btn.x=788,this.stop_btn.y=297,this.addChild(this.stop_btn)},e.prototype.StartDraw=function(t){var e=this;this.randomTime.stop(),"Redraw"!=t.data&&this.removeChild(this.stop_btn),"One"==t.data&&egret.Tween.get(this.start_btn).call(function(){e.runNumber(e.buildNumber(e.prize[0]))}).wait(7e3).call(function(){var t=e.createBitmapByName("giai_nhat_title_png");t.x=705,t.y=27,e.addChild(t)}),"Two"==t.data&&(this.secondNumber.visible=!1,this.addChild(this.secondNumber),egret.Tween.get(this.secondNumber).call(function(){e.runNumber(e.buildNumber(e.prize[1]))}).wait(7e3).call(function(){e.secondNumber.visible=!0,e.secondNumber.alpha=.3}).to({alpha:1,y:320},300,egret.Ease.sineIn).call(function(){e.runNumber(e.buildNumber(e.prize[2]))}).wait(7e3).call(function(){var t=e.createBitmapByName("giai_nhi_title_png");t.x=705,t.y=27,e.addChild(t)})),"Three"==t.data&&(this.thirdNumber_1.visible=this.thirdNumber_2.visible=!1,this.addChild(this.thirdNumber_1),this.addChild(this.thirdNumber_2),egret.Tween.get(this.thirdNumber_1).call(function(){e.runNumber(e.buildNumber(e.prize[3]))}).wait(7e3).call(function(){e.thirdNumber_1.visible=!0,e.thirdNumber_1.alpha=.3}).to({alpha:1,x:690,y:320},300,egret.Ease.sineIn).call(function(){e.runNumber(e.buildNumber(e.prize[4]))}).wait(7e3).call(function(){e.thirdNumber_2.visible=!0,e.thirdNumber_2.alpha=.3,egret.Tween.get(e.thirdNumber_2).to({alpha:1,x:980,y:320},300,egret.Ease.sineIn)}).wait(300).call(function(){e.runNumber(e.buildNumber(e.prize[5]))}).wait(7e3).call(function(){var t=e.createBitmapByName("giai_ba_title_png");t.x=705,t.y=27,e.addChild(t)})),"Four"==t.data&&(this.fourthNumber_1.visible=this.fourthNumber_2.visible=this.fourthNumber_3.visible=this.fourthNumber_4.visible=!1,this.addChild(this.fourthNumber_1),this.addChild(this.fourthNumber_2),this.addChild(this.fourthNumber_3),this.addChild(this.fourthNumber_4),egret.Tween.get(this.fourthNumber_1).call(function(){e.runNumber(e.buildNumber(e.prize[6]))}).wait(7e3).call(function(){e.fourthNumber_1.visible=!0,e.fourthNumber_1.alpha=.3}).to({alpha:1,x:450,y:320},300,egret.Ease.sineIn).call(function(){e.runNumber(e.buildNumber(e.prize[7]))}).wait(7e3).call(function(){e.fourthNumber_2.visible=!0,e.fourthNumber_2.alpha=.3,egret.Tween.get(e.fourthNumber_2).to({alpha:1,x:690,y:320},300,egret.Ease.sineIn)}).wait(300).call(function(){e.runNumber(e.buildNumber(e.prize[8]))}).wait(7e3).call(function(){e.fourthNumber_3.visible=!0,e.fourthNumber_3.alpha=.3,egret.Tween.get(e.fourthNumber_3).to({alpha:1,x:980,y:320},300,egret.Ease.sineIn)}).wait(300).call(function(){e.runNumber(e.buildNumber(e.prize[9]))}).wait(7e3).call(function(){e.fourthNumber_4.visible=!0,e.fourthNumber_4.alpha=.3,egret.Tween.get(e.fourthNumber_4).to({alpha:1,x:1230,y:320},300,egret.Ease.sineIn)}).wait(300).call(function(){e.runNumber(e.buildNumber(e.prize[10]))}).wait(7e3).call(function(){var t=e.createBitmapByName("giai_bon_title_png");t.x=705,t.y=27,e.addChild(t)})),"Redraw"==t.data&&(this.redrawNumber=this.redrawNumber+1,egret.Tween.get(this.start_btn).call(function(){e.runNumber(e.buildNumber(e.prize[e.redrawNumber]))}).wait(7e3))},e.prototype.DrawScene=function(t){var e=this.createBitmapByName("draw_scene_"+t.data);this.addChild(e),"DrawScene"==t.data&&(console.log("Quay số, add text 000:"),this.start_btn=this.createBitmapByName("start_btn_png"),this.start_btn.x=788,this.start_btn.y=297,this.addChild(this.start_btn),this.drawNumber_1=new egret.BitmapText,this.drawNumber_2=new egret.BitmapText,this.drawNumber_3=new egret.BitmapText,this.secondNumber=new egret.BitmapText,this.thirdNumber_1=new egret.BitmapText,this.thirdNumber_2=new egret.BitmapText,this.fourthNumber_1=new egret.BitmapText,this.fourthNumber_2=new egret.BitmapText,this.fourthNumber_3=new egret.BitmapText,this.fourthNumber_4=new egret.BitmapText,this.secondNumber.font=this.thirdNumber_1.font=this.thirdNumber_2.font=this.fourthNumber_1.font=this.fourthNumber_2.font=this.fourthNumber_3.font=this.fourthNumber_4.font=this.drawNumber_1.font=this.drawNumber_2.font=this.drawNumber_3.font=RES.getRes("number_fnt"),this.secondNumber.y=this.thirdNumber_1.y=this.thirdNumber_2.y=this.fourthNumber_1.y=this.fourthNumber_2.y=this.fourthNumber_3.y=this.fourthNumber_4.y=this.drawNumber_1.y=this.drawNumber_2.y=this.drawNumber_3.y=155,this.secondNumber.text=this.buildNumber(this.prize[1]),this.thirdNumber_1.text=this.buildNumber(this.prize[3]),this.thirdNumber_2.text=this.buildNumber(this.prize[4]),this.fourthNumber_1.text=this.buildNumber(this.prize[6]),this.fourthNumber_2.text=this.buildNumber(this.prize[7]),this.fourthNumber_3.text=this.buildNumber(this.prize[8]),this.fourthNumber_4.text=this.buildNumber(this.prize[9]),this.secondNumber.x=this.thirdNumber_1.x=this.thirdNumber_2.x=this.fourthNumber_1.x=this.fourthNumber_2.x=this.fourthNumber_3.x=this.fourthNumber_4.x=850,this.drawNumber_1.text=this.drawNumber_2.text=this.drawNumber_3.text="0",this.drawNumber_1.x=715,this.drawNumber_2.x=915,this.drawNumber_3.x=1115,this.addChild(this.drawNumber_1),this.addChild(this.drawNumber_2),this.addChild(this.drawNumber_3))},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,r=RES.getRes(t);return e.texture=r,e},e.prototype.startAnimation=function(t){var e=this,r=new egret.HtmlTextParser,i=t.map(function(t){return r.parse(t)}),n=this.textfield,a=-1,s=function(){a++,a>=i.length&&(a=0);var t=i[a];n.textFlow=t;var r=egret.Tween.get(n);r.to({alpha:1},200),r.wait(2e3),r.to({alpha:0},200),r.call(s,e)};s()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var WebSocketControl=function(t){function e(){var e=t.call(this)||this;return e.text="Khởi động ứng dụng",e.initStateText(),e.initWebSocket(),e}return __extends(e,t),e.prototype.initStateText=function(){this.stateText=new egret.TextField,this.stateText.size=22,this.stateText.text=this.text,this.stateText.width=480,this.addChild(this.stateText)},e.prototype.initWebSocket=function(){this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_STRING,this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.socket.connectByUrl("wss://ws.achex.ca")},e.prototype.sendData=function(){this.socket.writeUTF('{"auth":"luckyUser@727","passwd":"123456"}'),this.socket.writeUTF('{"joinHub":"lg@00000727","passwd":"none"}')},e.prototype.socketCommand=function(t){this.socket.writeUTF(t)},e.prototype.onSocketOpen=function(){this.trace("Sẵn sàng kết nối"),this.sendData()},e.prototype.onSocketClose=function(){this.trace("Kết nối đóng lại")},e.prototype.onSocketError=function(){this.trace("Kết nối bị lỗi")},e.prototype.onReceiveMessage=function(t){var e=this.socket.readUTF(),r=JSON.parse(e);"undefined"!=typeof r.auth&&("OK"==r.auth?this.trace("Kết nối thành công"):this.trace("Kết nối thất bại")),"undefined"!=typeof r.joinHub&&("OK"==r.joinHub?(this.trace("Hệ thống sẵn sàng"),this.dispatchEventWith("systemReady")):this.trace("Hệ thống chưa sẵn sàng")),"undefined"!=typeof r.maxPeople&&(this.trace("Đã nhận số người tham dự: "+r.maxPeople),this.dispatchEventWith("getMaxPeople",!0,r.maxPeople,!1)),"undefined"!=typeof r.drawPrize&&(this.trace("Đã nhận chuyển cảnh quay số: "+r.drawPrize),this.dispatchEventWith("drawPrize",!0,r.drawPrize,!1)),"undefined"!=typeof r.startDraw&&(this.trace("Đã nhận lệnh quay số: "+r.startDraw),this.dispatchEventWith("startDraw",!0,r.startDraw,!1)),"undefined"!=typeof r.randomNow&&(this.trace("Đã nhận lệnh chạy số ngẫu nhiên, bắt đầu quay số"),this.dispatchEventWith("randomNow"))},e.prototype.trace=function(t){this.text=this.text+"\n"+t,this.stateText.text=this.text,egret.log(t)},e}(egret.DisplayObjectContainer);__reflect(WebSocketControl.prototype,"WebSocketControl");