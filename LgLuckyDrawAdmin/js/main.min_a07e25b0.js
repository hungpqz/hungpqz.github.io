var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(a,o){function h(t){try{_(n.next(t))}catch(e){o(e)}}function s(t){try{_(n["throw"](t))}catch(e){o(e)}}function _(t){t.done?a(t.value):new i(function(e){e(t.value)}).then(h,s)}_((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(a)throw new TypeError("Generator is already executing.");for(;_;)try{if(a=1,o&&(h=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(h=h.call(o,i[1])).done)return h;switch(o=0,h&&(i=[0,h.value]),i[0]){case 0:case 1:h=i;break;case 4:return _.label++,{value:i[1],done:!1};case 5:_.label++,o=i[1],i=[0];continue;case 7:i=_.ops.pop(),_.trys.pop();continue;default:if(h=_.trys,!(h=h.length>0&&h[h.length-1])&&(6===i[0]||2===i[0])){_=0;continue}if(3===i[0]&&(!h||i[1]>h[0]&&i[1]<h[3])){_.label=i[1];break}if(6===i[0]&&_.label<h[1]){_.label=h[1],h=i;break}if(h&&_.label<h[2]){_.label=h[2],_.ops.push(i);break}h[2]&&_.ops.pop(),_.trys.pop();continue}i=e.call(t,_)}catch(n){i=[6,n],o=0}finally{a=h=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var a,o,h,s,_={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Đang tải, chờ tý..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){var e=t.call(this)||this;return e.buttonPress=0,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return i.sent(),this.stage.removeChild(t),[3,4];case 3:return e=i.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.createGameScene=function(){var t=this,e=this.createBitmapByName("bg_jpg");this.addChild(e);var i=this.stage.stageWidth,n=this.stage.stageHeight;e.width=i,e.height=n,this.wSocket=new WebSocketControl,this.wSocket.x=i/2-100,this.wSocket.y=100,this.addChild(this.wSocket),this.textfield=new egret.TextField,this.giai_nhat_btn=this.createBitmapByName("quay_giai_nhat_btn_png"),this.giai_nhi_btn=this.createBitmapByName("quay_giai_nhi_btn_png"),this.giai_ba_btn=this.createBitmapByName("quay_giai_ba_btn_png"),this.giai_bon_btn=this.createBitmapByName("quay_giai_bon_btn_png"),this.quay_giai_nhat_btn=this.createBitmapByName("quay_du_giai_nhat_btn_png"),this.quay_giai_nhi_btn=this.createBitmapByName("quay_du_giai_nhi_btn_png"),this.quay_giai_ba_btn=this.createBitmapByName("quay_du_giai_ba_btn_png"),this.quay_giai_bon_btn=this.createBitmapByName("quay_du_giai_bon_btn_png"),this.nhap_so_nguoi_btn=this.createBitmapByName("nhap_so_nguoi_btn_png"),this.quay_lai_btn=this.createBitmapByName("quay_lai_btn_png"),this.tro_ve_btn=this.createBitmapByName("tro_ve_btn_png"),this.vao_man_hinh_quay_btn=this.createBitmapByName("vao_man_hinh_quay_btn_png"),this.chay_so_btn=this.createBitmapByName("chay_so_btn_png"),this.quay_lai_btn.touchEnabled=this.chay_so_btn.touchEnabled=this.quay_giai_nhat_btn.touchEnabled=this.quay_giai_nhi_btn.touchEnabled=this.quay_giai_ba_btn.touchEnabled=this.quay_giai_bon_btn.touchEnabled=this.vao_man_hinh_quay_btn.touchEnabled=this.giai_ba_btn.touchEnabled=this.giai_bon_btn.touchEnabled=this.giai_nhat_btn.touchEnabled=this.giai_nhi_btn.touchEnabled=this.nhap_so_nguoi_btn.touchEnabled=this.tro_ve_btn.touchEnabled=!0,this.giai_nhat_btn.x=this.giai_ba_btn.x=25,this.giai_bon_btn.x=this.giai_nhi_btn.x=335,this.giai_nhat_btn.y=this.giai_nhi_btn.y=810,this.giai_ba_btn.y=this.giai_bon_btn.y=990,this.vao_man_hinh_quay_btn.x=this.nhap_so_nguoi_btn.x=this.textfield.x=this.quay_giai_nhat_btn.x=this.quay_giai_nhi_btn.x=this.quay_giai_ba_btn.x=this.quay_giai_bon_btn.x=this.quay_lai_btn.x=this.tro_ve_btn.x=this.chay_so_btn.x=180,this.vao_man_hinh_quay_btn.y=this.nhap_so_nguoi_btn.y=this.quay_giai_nhat_btn.y=this.quay_giai_nhi_btn.y=this.quay_giai_ba_btn.y=this.quay_giai_bon_btn.y=590,this.chay_so_btn.y=580-this.chay_so_btn.height,this.quay_lai_btn.y=610+this.quay_lai_btn.height,this.tro_ve_btn.y=620+2*this.tro_ve_btn.height,this.textfield.y=this.nhap_so_nguoi_btn.y-this.nhap_so_nguoi_btn.height-20,this.textfield.width=this.nhap_so_nguoi_btn.width,this.textfield.border=!0,this.textfield.borderColor=10066329,this.textfield.verticalAlign=egret.VerticalAlign.MIDDLE,this.textfield.type=egret.TextFieldType.INPUT,this.textfield.text="Nhập số người",this.textfield.size=40,this.textfield.height=80,this.wSocket.addEventListener("systemReady",function(){t.addChild(t.nhap_so_nguoi_btn),t.addChild(t.textfield),t.textfield.addEventListener(egret.FocusEvent.FOCUS_IN,function(){"Nhập số người"==t.textfield.text&&(t.textfield.text="")},t),t.textfield.addEventListener(egret.FocusEvent.FOCUS_OUT,function(){""==t.textfield.text&&(t.textfield.text="Nhập số người")},t),t.nhap_so_nguoi_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.wSocket.socketCommand('{"toH":"lg@00000727","maxPeople":"'+t.textfield.text+'"}'),t.removeChild(t.nhap_so_nguoi_btn),t.removeChild(t.textfield),t.luckyDraw()},t)},this)},e.prototype.luckyDraw=function(){var t=this;this.addChild(this.giai_ba_btn),this.addChild(this.giai_bon_btn),this.addChild(this.giai_nhat_btn),this.addChild(this.giai_nhi_btn),this.tro_ve_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.backHome,this),this.quay_giai_nhat_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.wSocket.socketCommand('{"toH":"lg@00000727","startDraw":"One"}'),t.removeChild(t.quay_giai_nhat_btn)},this),this.quay_giai_nhi_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.wSocket.socketCommand('{"toH":"lg@00000727","startDraw":"Two"}'),t.removeChild(t.quay_giai_nhi_btn)},this),this.quay_giai_ba_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.wSocket.socketCommand('{"toH":"lg@00000727","startDraw":"Three"}'),t.removeChild(t.quay_giai_ba_btn)},this),this.quay_giai_bon_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.wSocket.socketCommand('{"toH":"lg@00000727","startDraw":"Four"}'),t.removeChild(t.quay_giai_bon_btn)},this),this.quay_lai_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.wSocket.socketCommand('{"toH":"lg@00000727","startDraw":"Redraw"}')},this),this.vao_man_hinh_quay_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){switch(t.buttonPress){case 1:t.addChild(t.quay_giai_nhat_btn);break;case 2:t.addChild(t.quay_giai_nhi_btn);break;case 3:t.addChild(t.quay_giai_ba_btn);break;case 4:t.addChild(t.quay_giai_bon_btn)}t.addChild(t.quay_lai_btn),t.addChild(t.chay_so_btn),t.removeChild(t.vao_man_hinh_quay_btn),t.addChild(t.tro_ve_btn),t.wSocket.socketCommand('{"toH":"lg@00000727","drawPrize":"DrawScene"}')},this),this.chay_so_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.wSocket.socketCommand('{"toH":"lg@00000727","randomNow":"OK"}'),t.removeChild(t.chay_so_btn)},this),this.giai_nhat_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.removeChild(t.giai_nhat_btn),t.removeChild(t.giai_nhi_btn),t.removeChild(t.giai_ba_btn),t.removeChild(t.giai_bon_btn),t.wSocket.socketCommand('{"toH":"lg@00000727","drawPrize":"One"}'),t.addChild(t.vao_man_hinh_quay_btn),t.buttonPress=1},this),this.giai_nhi_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.removeChild(t.giai_nhat_btn),t.removeChild(t.giai_nhi_btn),t.removeChild(t.giai_ba_btn),t.removeChild(t.giai_bon_btn),t.wSocket.socketCommand('{"toH":"lg@00000727","drawPrize":"Two"}'),t.addChild(t.vao_man_hinh_quay_btn),t.buttonPress=2},this),this.giai_ba_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.removeChild(t.giai_nhat_btn),t.removeChild(t.giai_nhi_btn),t.removeChild(t.giai_ba_btn),t.removeChild(t.giai_bon_btn),t.wSocket.socketCommand('{"toH":"lg@00000727","drawPrize":"Three"}'),t.addChild(t.vao_man_hinh_quay_btn),t.buttonPress=3},this),this.giai_bon_btn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.removeChild(t.giai_nhat_btn),t.removeChild(t.giai_nhi_btn),t.removeChild(t.giai_ba_btn),t.removeChild(t.giai_bon_btn),t.wSocket.socketCommand('{"toH":"lg@00000727","drawPrize":"Four"}'),t.addChild(t.vao_man_hinh_quay_btn),t.buttonPress=4},this)},e.prototype.backHome=function(){this.buttonPress=0,this.removeChild(this.tro_ve_btn),this.removeChild(this.quay_lai_btn),this.addChild(this.giai_ba_btn),this.addChild(this.giai_bon_btn),this.addChild(this.giai_nhat_btn),this.addChild(this.giai_nhi_btn)},e.prototype.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},e.prototype.startAnimation=function(t){var e=this,i=new egret.HtmlTextParser,n=t.map(function(t){return i.parse(t)}),a=this.textfield,o=-1,h=function(){o++,o>=n.length&&(o=0);var t=n[o];a.textFlow=t;var i=egret.Tween.get(a);i.to({alpha:1},200),i.wait(2e3),i.to({alpha:0},200),i.call(h,e)};h()},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");var WebSocketControl=function(t){function e(){var e=t.call(this)||this;return e.text="Khởi động ứng dụng",e.initStateText(),e.initWebSocket(),e}return __extends(e,t),e.prototype.initStateText=function(){this.stateText=new egret.TextField,this.stateText.size=22,this.stateText.text=this.text,this.stateText.width=480,this.addChild(this.stateText)},e.prototype.initWebSocket=function(){this.socket=new egret.WebSocket,this.socket.type=egret.WebSocket.TYPE_STRING,this.socket.addEventListener(egret.ProgressEvent.SOCKET_DATA,this.onReceiveMessage,this),this.socket.addEventListener(egret.Event.CONNECT,this.onSocketOpen,this),this.socket.addEventListener(egret.Event.CLOSE,this.onSocketClose,this),this.socket.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onSocketError,this),this.socket.connectByUrl("wss://ws.achex.ca")},e.prototype.sendData=function(){this.socket.writeUTF('{"auth":"admin@727","passwd":"123456"}'),this.socket.writeUTF('{"joinHub":"lg@00000727","passwd":"none"}')},e.prototype.socketCommand=function(t){this.socket.writeUTF(t)},e.prototype.onSocketOpen=function(){this.trace("Sẵn sàng kết nối"),this.sendData()},e.prototype.onSocketClose=function(){this.trace("Kết nối đóng lại")},e.prototype.onSocketError=function(){this.trace("Kết nối bị lỗi")},e.prototype.onReceiveMessage=function(t){var e=this.socket.readUTF(),i=JSON.parse(e);"undefined"!=typeof i.auth&&("OK"==i.auth?this.trace("Kết nối thành công"):this.trace("Kết nối thất bại")),"undefined"!=typeof i.joinHub&&("OK"==i.joinHub?(this.trace("Hệ thống sẵn sàng"),this.dispatchEventWith("systemReady")):this.trace("Hệ thống chưa sẵn sàng"))},e.prototype.trace=function(t){this.text=this.text+"\n"+t,this.stateText.text=this.text,egret.log(t)},e}(egret.DisplayObjectContainer);__reflect(WebSocketControl.prototype,"WebSocketControl");