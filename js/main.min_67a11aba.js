var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},fighter;!function(t){var e=function(e){function i(t,i){var r=e.call(this,t)||this;return r.textureName=i,r}return __extends(i,e),i.produce=function(e){null==t.Bullet.cacheDict[e]&&(t.Bullet.cacheDict[e]=[]);var i,r=t.Bullet.cacheDict[e];return i=r.length>0?r.pop():new t.Bullet(RES.getRes(e),e)},i.reclaim=function(e){var i=e.textureName;null==t.Bullet.cacheDict[i]&&(t.Bullet.cacheDict[i]=[]);var r=t.Bullet.cacheDict[i];-1==r.indexOf(e)&&r.push(e)},i.cacheDict={},i}(egret.Bitmap);t.Bullet=e,__reflect(e.prototype,"fighter.Bullet")}(fighter||(fighter={}));var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.x=120,this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.setProgress=function(t,e){this.textField.text="Đang tải trò chơi..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var fighter;!function(t){var e=function(e){function i(t,i,r){var s=e.call(this)||this;return s.blood=10,s.fireDelay=i,s.bmp=new egret.Bitmap(t),s.textureName=r,s.addChild(s.bmp),s.fireTimer=new egret.Timer(i),s.fireTimer.addEventListener(egret.TimerEvent.TIMER,s.createBullet,s),s}return __extends(i,e),i.produce=function(e,i){null==t.Airplane.cacheDict[e]&&(t.Airplane.cacheDict[e]=[]);var r,s=t.Airplane.cacheDict[e];return r=s.length>0?s.pop():new t.Airplane(RES.getRes(e),i,e),r.blood=10,r},i.reclaim=function(e){var i=e.textureName;null==t.Airplane.cacheDict[i]&&(t.Airplane.cacheDict[i]=[]);var r=t.Airplane.cacheDict[i];-1==r.indexOf(e)&&r.push(e)},i.prototype.fire=function(){this.fireTimer.start()},i.prototype.stopFire=function(){this.fireTimer.stop()},i.prototype.createBullet=function(t){this.dispatchEventWith("createBullet")},i.cacheDict={},i}(egret.DisplayObjectContainer);t.Airplane=e,__reflect(e.prototype,"fighter.Airplane")}(fighter||(fighter={}));var fighter;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.speed=5,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(i,e),i.prototype.onAddToStage=function(e){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight;var i=RES.getRes("bgImage");this.textureHeight=i.textureHeight,this.rowCount=Math.ceil(this.stageH/this.textureHeight)+1,this.bmpArr=[];for(var r=0;r<this.rowCount;r++){var s=t.createBitmapByName("bgImage");s.y=this.textureHeight*r-(this.textureHeight*this.rowCount-this.stageH),this.bmpArr.push(s),this.addChild(s)}},i.prototype.start=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},i.prototype.enterFrameHandler=function(t){for(var e=0;e<this.rowCount;e++){var i=this.bmpArr[e];i.y+=this.speed,i.y>this.stageH&&(i.y=this.bmpArr[0].y-this.textureHeight,this.bmpArr.pop(),this.bmpArr.unshift(i))}},i.prototype.pause=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)},i}(egret.DisplayObjectContainer);t.BgMap=e,__reflect(e.prototype,"fighter.BgMap")}(fighter||(fighter={}));var fighter;!function(t){var e=function(t){function e(){var e=t.call(this)||this,i=e.graphics;return i.beginFill(0,.8),i.drawRect(0,0,640,50),i.endFill(),e.txt=new egret.TextField,e.txt.width=600,e.txt.height=50,e.txt.textAlign="left",e.txt.textColor=16777215,e.txt.size=24,e.txt.y=5,e.txt.x=5,e.addChild(e.txt),e.touchChildren=!1,e.touchEnabled=!1,e}return __extends(e,t),e.prototype.showBlood=function(t,e){var i="Năng lượng:"+t+" - Điểm số:"+e;this.txt.text=i},e}(egret.Sprite);t.BloodBar=e,__reflect(e.prototype,"fighter.BloodBar")}(fighter||(fighter={}));var Main=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.isThemeLoadEnd=!1,e.isResourceLoadEnd=!1,e}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this);var e=new eui.Theme("resource/default.thm.json",this.stage);e.addEventListener(eui.UIEvent.COMPLETE,this.onThemeLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.loadGroup("preload")},e.prototype.onThemeLoadComplete=function(){this.isThemeLoadEnd=!0,this.createScene()},e.prototype.onResourceLoadComplete=function(t){"preload"==t.groupName&&(this.stage.removeChild(this.loadingView),RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.isResourceLoadEnd=!0,this.createScene())},e.prototype.createScene=function(){if(this.isThemeLoadEnd&&this.isResourceLoadEnd){var t=new fighter.GameContainer;this.addChild(t);var e=new particle.GravityParticleSystem(RES.getRes("newParticle_png"),RES.getRes("newParticle_json"));this.addChild(e),e.start(),e.y=0,e.x=this.stage.stageWidth/2,e.emitterX=0,e.emitterY=0,e.scaleX=e.scaleY=1.5}},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"preload"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var fighter;!function(t){var e=function(e){function i(){var t=e.call(this)||this;return t.myBullets=[],t.enemyFighters=[],t.enemyBossFighters=[],t.enemyFightersTimer=new egret.Timer(1e3),t.enemyBossFightersTimer=new egret.Timer(2e3),t.enemyBullets=[],t.myScore=0,t.bgSound=new SoundBase("bgSound"),t.explosion=new SoundBase("explosion"),t._lastTime=egret.getTimer(),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(i,e),i.prototype.onAddToStage=function(t){this.removeEventListener(egret.Event.ADDED_TO_STAGE,this.onAddToStage,this),this.createGameScene()},i.prototype.createGameScene=function(){this.stageW=this.stage.stageWidth,this.stageH=this.stage.stageHeight,this.bg=new t.BgMap,this.addChild(this.bg),this.btnStart=t.createBitmapByName("btnStart"),this.btnStart.x=(this.stageW-this.btnStart.width)/2,this.btnStart.y=(this.stageH-this.btnStart.height)/2,this.btnStart.touchEnabled=!0,this.btnStart.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gameStart,this),this.addChild(this.btnStart),this.myFighter=new t.Airplane(RES.getRes("f1"),100,"f1"),this.myFighter.y=this.stageH-this.myFighter.height-50,this.addChild(this.myFighter),this.scorePanel=new t.ScorePanel,this.BloodBar=new t.BloodBar,this.healthbar=new t.healthbar,this.preCreatedInstance()},i.prototype.preCreatedInstance=function(){var e=0,i=[];for(e=0;20>e;e++){var r=t.Bullet.produce("b1");i.push(r)}for(e=0;20>e;e++)r=i.pop(),t.Bullet.reclaim(r);for(e=0;20>e;e++){var r=t.Bullet.produce("b2");i.push(r)}for(e=0;20>e;e++)r=i.pop(),t.Bullet.reclaim(r);for(e=0;20>e;e++){var s=t.Airplane.produce("f2",1e3);i.push(s);var h=t.Airplane.produce("boss",2e3);i.push(h)}for(e=0;20>e;e++)s=i.pop(),t.Airplane.reclaim(s),h=i.pop(),t.Airplane.reclaim(h)},i.prototype.gameStart=function(){this.bgSound.play(),this.bgSound.setLoop(1),this.myScore=0,this.removeChild(this.btnStart),this.bg.start(),this.touchEnabled=!0,this.addEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),this.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchHandler,this),this.myFighter.x=(this.stageW-this.myFighter.width)/2,this.myFighter.fire(),this.myFighter.blood=10,this.BloodBar.x=0,this.BloodBar.y=0,this.healthbar.x=0,this.healthbar.y=0,this.addChild(this.healthbar),this.myFighter.addEventListener("createBullet",this.createBulletHandler,this),this.enemyFightersTimer.addEventListener(egret.TimerEvent.TIMER,this.createEnemyFighter,this),this.enemyFightersTimer.start(),this.enemyBossFightersTimer.addEventListener(egret.TimerEvent.TIMER,this.createEnemyBossFighter,this),this.enemyBossFightersTimer.start(),this.scorePanel.parent==this&&this.removeChild(this.scorePanel)},i.prototype.touchHandler=function(t){if(t.type==egret.TouchEvent.TOUCH_MOVE){var e=t.localX;e=Math.max(0,e),e=Math.min(this.stageW-this.myFighter.width,e),this.myFighter.x=e}},i.prototype.createBulletHandler=function(e){var i;if(e.target==this.myFighter)for(var r=0;2>r;r++)i=t.Bullet.produce("b1"),i.x=0==r?this.myFighter.x+10:this.myFighter.x+this.myFighter.width-22,i.y=this.myFighter.y+30,this.addChildAt(i,this.numChildren-1-this.enemyFighters.length),this.myBullets.push(i);else{var s=e.target;i=t.Bullet.produce("b2"),i.x=s.x+28,i.y=s.y+10,this.addChildAt(i,this.numChildren-1-this.enemyFighters.length),this.enemyBullets.push(i)}},i.prototype.createEnemyFighter=function(e){var i=t.Airplane.produce("f2",1e3);i.x=Math.random()*(this.stageW-i.width),i.y=-i.height-300*Math.random(),i.addEventListener("createBullet",this.createBulletHandler,this),i.fire(),this.addChildAt(i,this.numChildren-1),this.enemyFighters.push(i)},i.prototype.createEnemyBossFighter=function(e){var i=t.Airplane.produce("boss",1e3);i.x=Math.random()*(this.stageW-i.width),i.y=-i.height-300*Math.random(),i.addEventListener("createBullet",this.createBulletHandler,this),i.fire(),this.addChildAt(i,this.numChildren-1),this.enemyBossFighters.push(i)},i.prototype.gameViewUpdate=function(e){var i=egret.getTimer(),r=1e3/(i-this._lastTime);this._lastTime=i;for(var s,h=60/r,n=0,o=this.myBullets.length;o>n;n++)s=this.myBullets[n],s.y<-s.height&&(this.removeChild(s),t.Bullet.reclaim(s),this.myBullets.splice(n,1),n--,o--),s.y-=12*h;var a,l=this.enemyFighters.length,d=this.enemyBossFighters.length;for(n=0;l>n;n++)a=this.enemyFighters[n],a.y>this.stage.stageHeight&&(this.removeChild(a),t.Airplane.reclaim(a),a.removeEventListener("createBullet",this.createBulletHandler,this),a.stopFire(),this.enemyFighters.splice(n,1),n--,l--),a.y+=4*h;for(n=0;d>n;n++)a=this.enemyBossFighters[n],a.y>this.stage.stageHeight&&(this.removeChild(a),t.Airplane.reclaim(a),a.removeEventListener("createBullet",this.createBulletHandler,this),a.stopFire(),this.enemyBossFighters.splice(n,1),n--,d--),a.y+=4*h;var u=this.enemyBullets.length;for(n=0;u>n;n++)s=this.enemyBullets[n],s.y>this.stage.stageHeight&&(this.removeChild(s),t.Bullet.reclaim(s),this.enemyBullets.splice(n,1),n--,u--),s.y+=8*h;this.gameHitTest()},i.prototype.gameHitTest=function(){var e,i,r,s,h=this.myBullets.length,n=this.enemyFighters.length,o=this.enemyBossFighters.length,a=this.enemyBullets.length,l=[],d=[],u=[];for(e=0;h>e;e++){for(r=this.myBullets[e],i=0;n>i;i++)s=this.enemyFighters[i],t.GameUtil.hitTest(s,r)&&(s.blood-=2,-1==l.indexOf(r)&&l.push(r),s.blood<=0&&-1==d.indexOf(s)&&(d.push(s),this.explosion.play()));for(i=0;o>i;i++)s=this.enemyBossFighters[i],t.GameUtil.hitTest(s,r)&&(s.blood-=1,console.log("Bullet hit the Boss. The fighter blood:"+s.blood),-1==l.indexOf(r)&&l.push(r),s.blood<=0&&-1==u.indexOf(s)&&(this.explosion.play(),u.push(s)))}for(e=0;a>e;e++)r=this.enemyBullets[e],t.GameUtil.hitTest(this.myFighter,r)&&(this.myFighter.blood-=1,-1==l.indexOf(r)&&l.push(r));for(e=0;n>e;e++)s=this.enemyFighters[e],t.GameUtil.hitTest(this.myFighter,s)&&(this.myFighter.blood-=10);if(this.healthbar.showHealthBar(this.myFighter.blood),this.myFighter.blood<=0)this.gameStop();else{for(;l.length>0;)r=l.pop(),this.removeChild(r),"b1"==r.textureName?this.myBullets.splice(this.myBullets.indexOf(r),1):this.enemyBullets.splice(this.enemyBullets.indexOf(r),1),t.Bullet.reclaim(r);for(this.myScore+=d.length;d.length>0;)s=d.pop(),s.stopFire(),s.removeEventListener("createBullet",this.createBulletHandler,this),this.removeChild(s),this.enemyFighters.splice(this.enemyFighters.indexOf(s),1),t.Airplane.reclaim(s);for(;u.length>0;)s=u.pop(),s.stopFire(),s.removeEventListener("createBullet",this.createBulletHandler,this),this.removeChild(s),this.enemyBossFighters.splice(this.enemyBossFighters.indexOf(s),1),t.Airplane.reclaim(s)}},i.prototype.gameStop=function(){this.addChild(this.btnStart),this.bg.pause(),this.bgSound.pause(),this.removeEventListener(egret.Event.ENTER_FRAME,this.gameViewUpdate,this),this.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchHandler,this),this.myFighter.stopFire(),this.myFighter.removeEventListener("createBullet",this.createBulletHandler,this),this.enemyFightersTimer.removeEventListener(egret.TimerEvent.TIMER,this.createEnemyFighter,this),this.enemyFightersTimer.stop(),this.enemyBossFightersTimer.removeEventListener(egret.TimerEvent.TIMER,this.createEnemyBossFighter,this),this.enemyBossFightersTimer.stop();for(var e;this.myBullets.length>0;)e=this.myBullets.pop(),this.removeChild(e),t.Bullet.reclaim(e);for(;this.enemyBullets.length>0;)e=this.enemyBullets.pop(),this.removeChild(e),t.Bullet.reclaim(e);for(var i;this.enemyFighters.length>0;)i=this.enemyFighters.pop(),i.stopFire(),i.removeEventListener("createBullet",this.createBulletHandler,this),this.removeChild(i),t.Airplane.reclaim(i);for(;this.enemyBossFighters.length>0;)i=this.enemyBossFighters.pop(),i.stopFire(),i.removeEventListener("createBullet",this.createBulletHandler,this),this.removeChild(i),t.Airplane.reclaim(i);this.scorePanel.showScore(this.myScore),this.scorePanel.x=(this.stageW-this.scorePanel.width)/2,this.scorePanel.y=100,this.addChild(this.scorePanel)},i}(egret.DisplayObjectContainer);t.GameContainer=e,__reflect(e.prototype,"fighter.GameContainer")}(fighter||(fighter={}));var fighter;!function(t){var e=function(t){function e(){var e=t.call(this)||this;return e.hbar=new egret.Bitmap(RES.getRes("bloodBar")),e.heart=new egret.Bitmap(RES.getRes("heart")),e.hbarBg=new egret.Bitmap(RES.getRes("bloodBarBg")),e.hbar.width=150,e.hbarBg.width=150,e.hbar.height=50,e.hbarBg.height=50,e.heart.y=5,e.hbar.x=e.heart.width-5,e.hbarBg.x=e.heart.width-5,e.hbarWidth=e.hbar.width,e.addChild(e.hbarBg),e.addChild(e.hbar),e.addChild(e.heart),e}return __extends(e,t),e.prototype.showHealthBar=function(t){this.hbar.width=Math.round(t/10*this.hbarWidth),egret.log("Health bar width:"+this.hbar.width)},e}(egret.DisplayObjectContainer);t.healthbar=e,__reflect(e.prototype,"fighter.healthbar")}(fighter||(fighter={}));var fighter;!function(t){var e=function(t){function e(){var e=t.call(this)||this,i=e.graphics;return i.beginFill(0,.8),i.drawRect(0,0,400,200),i.endFill(),e.txt=new egret.TextField,e.txt.width=400,e.txt.height=200,e.txt.textAlign="center",e.txt.textColor=16777215,e.txt.size=24,e.txt.y=60,e.addChild(e.txt),e.touchChildren=!1,e.touchEnabled=!1,e}return __extends(e,t),e.prototype.showScore=function(t){var e="Điểm số của bạn:"+t+"\nChơi lại nhé";this.txt.text=e},e}(egret.Sprite);t.ScorePanel=e,__reflect(e.prototype,"fighter.ScorePanel")}(fighter||(fighter={}));var fighter;!function(t){function e(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e}var i=function(){function t(){}return t.hitTest=function(t,e){var i=t.getBounds(),r=e.getBounds();return i.x=t.x,i.y=t.y,r.x=e.x,r.y=e.y,i.intersects(r)},t}();t.GameUtil=i,__reflect(i.prototype,"fighter.GameUtil"),t.createBitmapByName=e}(fighter||(fighter={}));var SoundBase=function(t){function e(e){var i=t.call(this)||this;return i._soundURL="bgSound",i._positon=0,i._loop=1,i._status=0,e&&(i._soundURL=e),i._sound=new egret.Sound,i._loadSound(),i}return __extends(e,t),e.prototype._loadSound=function(){RES.getRes(this._soundURL)?this._sound=RES.getRes(this._soundURL):(this._sound.once(egret.Event.COMPLETE,this.loadComplete,this),this._sound.once(egret.IOErrorEvent.IO_ERROR,this.onLoadErr,this),this._sound.load(this._soundURL))},e.prototype.loadComplete=function(t){this._status=3;var e="��������";egret.log(e),this._sound.removeEventListener(egret.IOErrorEvent.IO_ERROR,this.onLoadErr,this),this.dispatchEventWith(egret.Event.COMPLETE,!1,e)},e.prototype.onLoadErr=function(t){this._status=4;var e="����ʧ��"+this._soundURL;egret.log(e),this._sound.removeEventListener(egret.Event.COMPLETE,this.loadComplete,this),this.dispatchEventWith(egret.IOErrorEvent.IO_ERROR,!1,e)},e.prototype.setUrl=function(t){this._soundURL=t,this._loadSound()},e.prototype.looped=function(t){console.log("looped"),this._soundChannel=null,this._positon=0,this._status=0;var e="��������";this._loop>=0?this.dispatchEventWith(egret.Event.SOUND_COMPLETE,!1,e):this.play()},e.prototype.getStatus=function(){return this._status},e.prototype.setVolume=function(t){console.log(this._status),1===this._status&&(this._soundChannel.volume=t/100)},e.prototype.showPosition=function(){return 1===this._status&&(this._positon=this._soundChannel.position),this._positon},e.prototype.play=function(){return 4===this._status?void this._loadSound():(this._status=1,this._soundChannel&&this._soundChannel.stop(),this._soundChannel=this._sound.play(this._positon,1),this._soundChannel.once(egret.Event.SOUND_COMPLETE,this.looped,this),this._status)},e.prototype.setLoop=function(t){return void 0===t&&(t=1),this._loop=t,t},e.prototype.pause=function(){var t=this._status;return 1===t&&(this._positon=this._soundChannel.position,this._soundChannel.stop(),this._status=2),egret.log(this._positon),t},e.prototype.resume=function(){var t=this._status;return 2===t&&this.play(),egret.log(this._positon),t},e.prototype.stop=function(){this._status=0,this._positon=0,this._soundChannel.stop(),this._soundChannel=null},e}(egret.DisplayObjectContainer);__reflect(SoundBase.prototype,"SoundBase");